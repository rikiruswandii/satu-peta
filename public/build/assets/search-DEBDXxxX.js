import{i as x}from"./Map-B3PszTVP.js";import{aU as A,aV as C,aq as q,aW as k,ap as V}from"./GeoJSON-DjKYdZcq.js";document.addEventListener("DOMContentLoaded",function(){const L=document.querySelectorAll(".regional-agency-checkbox"),p=document.getElementById("filterForm"),M=document.getElementById("searchForm");L.forEach(n=>{n.addEventListener("change",function(){const e=M.querySelector('input[name="search"]');if(e&&e.value){let t=p.querySelector('input[name="search"]');t||(t=document.createElement("input"),t.type="hidden",t.name="search",p.appendChild(t)),t.value=e.value}p.submit()})});function h(n,e){var t=new x({target:n,layers:[],view:new A({center:C([0,0]),zoom:0}),interactions:[],controls:[]});return e&&fetch(e).then(r=>r.json()).then(r=>{var i=new q({features:new k().readFeatures(r,{featureProjection:"EPSG:3857"})}),a=new V({source:i,style:function(c){return getStyle(c)}});t.addLayer(a);var o=i.getExtent();t.getView().fit(o,{padding:[10,10,10,10]})}),t}document.querySelectorAll(".map-preview").forEach(function(n){var e=n.getAttribute("data-geojson");h(n.id,e)}),document.querySelectorAll(".detailMapModalTrigger").forEach(function(n){n.addEventListener("click",function(){var e=this.getAttribute("data-geojson"),t=this.getAttribute("data-regional-agency"),r=this.getAttribute("data-sector"),i=this.getAttribute("data-name");this.getAttribute("data-card-id");var a=document.getElementById("detailMapModal");if(a){if(a.querySelector("#map-name").textContent=i||"Nama tidak tersedia",a.querySelector("#map-regional-agency").textContent=t||"Agensi tidak tersedia",a.querySelector("#map-sector").textContent=r||"Sektor tidak tersedia",!e){c.remove();return}var o=document.getElementById("detailMap");if(o){o.innerHTML="";var c=document.createElement("div");c.className="loading-overlay",c.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',o.appendChild(c);var g=initMap("detailMap",e);g.once("rendercomplete",function(){c.remove()})}else return}})});var l=document.getElementById("viewportLayering"),d=null;if(l){l.innerHTML="",l.style.height="200px",l.style.border="1px solid black";var u=document.createElement("div");u.className="loading-overlay",u.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',l.appendChild(u),d=initMap("viewportLayering"),d.once("rendercomplete",function(){d.on("moveend",function(){var e=d.getView().calculateExtent(),t=e[1],r=e[3],i=e[0],a=e[2];fetch(`/get-maps-by-viewport?minLat=${t}&maxLat=${r}&minLng=${i}&maxLng=${a}`).then(o=>o.json()).then(o=>{w(o.html,o.pagination),y()}).catch(o=>console.error("Error:",o))}),u.remove()});const n=document.getElementById("detailMapModal");n&&(n.addEventListener("hidden.bs.modal",function(){d&&setTimeout(()=>{d.updateSize();const e=d.getView(),t=e.getCenter();e.setCenter([t[0]+1,t[1]]),e.setCenter(t)},100)}),n.addEventListener("show.bs.modal",function(){if(d){const e=d.getView();d._savedCenter=e.getCenter(),d._savedZoom=e.getZoom()}}))}function w(n,e){const t=document.querySelector(".row .cardMapList");t.innerHTML=n;const r=document.querySelector(".mt-4 .cardPaginate");r&&(r.innerHTML=e),setTimeout(()=>{document.querySelectorAll(".map-preview").forEach(function(i){var a=i.getAttribute("data-geojson");a&&h(i.id,a)}),document.querySelectorAll(".detailMapModalTrigger").forEach(function(i){i.addEventListener("click",function(){var a=this.getAttribute("data-geojson"),o=this.getAttribute("data-regional-agency"),c=this.getAttribute("data-sector"),g=this.getAttribute("data-name"),s=document.getElementById("detailMapModal");if(s){s.querySelector("#map-name").textContent=g||"Nama tidak tersedia",s.querySelector("#map-regional-agency").textContent=o||"Agensi tidak tersedia",s.querySelector("#map-sector").textContent=c||"Sektor tidak tersedia";var v=document.getElementById("detailMap");if(v&&a){v.innerHTML="";var m=document.createElement("div");m.className="loading-overlay",m.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',v.appendChild(m);var b=new bootstrap.Modal(s);b.show(),s.addEventListener("shown.bs.modal",function(){var f=initMap("detailMap",a);f.once("rendercomplete",function(){m.remove()})},{once:!0}),s.addEventListener("hidden.bs.modal",function(){document.querySelectorAll(".modal-backdrop").forEach(function(f){f.remove()}),document.body.classList.remove("modal-open"),document.body.style.overflow="auto"},{once:!0})}}})}),y()},100)}function y(){document.querySelectorAll(".map-preview").forEach(n=>{const e=n.dataset.geojsonPath;if(e){const t=initMap(n.id);E(e).then(r=>{S(t,r)})}})}async function E(n){try{return await(await fetch(n)).json()}catch{return null}}function S(n,e){if(!e)return;const t=new(void 0).Vector({features:new(void 0).GeoJSON().readFeatures(e,{featureProjection:"EPSG:3857"})}),r=new(void 0).Vector({source:t,style:function(a){return getStyle(a)}});n.addLayer(r);const i=t.getExtent();n.getView().fit(i,{padding:[50,50,50,50]})}});
